---
import BaseLayout from '../layouts/BaseLayout.astro';
import ChatButton from '../components/ChatButton.astro';

const pageContext = `
Projects page - Brian Edwards has built 100+ projects using vibe coding and Claude Code.
Projects span multiple verticals: Education, Healthcare, Music, Gaming, E-commerce, Data Science.
Projects are ranked by total file size and include metrics like file count, commits, and delivery time.
`;

// This will eventually be populated from actual repo data
const projects = [
  // Education
  { name: "google-classroom", org: "bme-wacoisd", description: "Google Classroom API automation", vertical: "Education", size: "1.8 MB", files: 67, commits: 89 },
  { name: "tea", org: "bme-wacoisd", description: "Teacher assistant tools", vertical: "Education", size: "1.2 MB", files: 45, commits: 56 },
  { name: "elementary", org: "bme-wacoisd", description: "Elementary school management", vertical: "Education", size: "980 KB", files: 34, commits: 42 },
  { name: "school-scheduling", org: "bedwards", description: "School scheduling system", vertical: "Education", size: "1.5 MB", files: 52, commits: 78 },
  { name: "conjunction", org: "bedwards", description: "Educational game for conjunction learning", vertical: "Education", size: "890 KB", files: 28, commits: 45 },

  // Healthcare
  { name: "folk-care", org: "neighborhood-lab", description: "Open source home healthcare software", vertical: "Healthcare", size: "8.7 MB", files: 156, commits: 312 },
  { name: "med-record-space", org: "bedwards", description: "Privacy-first micro-EHR system", vertical: "Healthcare", size: "1.1 MB", files: 38, commits: 56 },
  { name: "derm-ai-stack", org: "bridgenet-tech", description: "AI dermatology stack", vertical: "Healthcare", size: "2.3 MB", files: 67, commits: 89 },

  // Music & Audio
  { name: "ghost-note", org: "audio-forge-rs", description: "Rust VST/CLAP audio plugin", vertical: "Music", size: "4.1 MB", files: 89, commits: 234 },
  { name: "DrivenByMoss", org: "audio-forge-rs", description: "Bitwig Studio extensions for many controllers", vertical: "Music", size: "12.3 MB", files: 456, commits: 1200 },
  { name: "nih-plug", org: "audio-forge-rs", description: "Rust VST3 and CLAP plugin framework", vertical: "Music", size: "3.4 MB", files: 123, commits: 345 },
  { name: "vibewig", org: "audio-forge-rs", description: "Bitwig vibe integration", vertical: "Music", size: "890 KB", files: 34, commits: 67 },
  { name: "concept-albums", org: "bedwards", description: "Concept album creation tools", vertical: "Music", size: "1.2 MB", files: 45, commits: 78 },

  // Gaming
  { name: "studio-rust-mcp-server", org: "splash-screen-studio", description: "Roblox Studio MCP Server", vertical: "Gaming", size: "890 KB", files: 23, commits: 45 },
  { name: "smash-showdown", org: "bedwards", description: "Game mechanics project", vertical: "Gaming", size: "1.8 MB", files: 56, commits: 89 },
  { name: "cubed-worlds", org: "world-stitchers", description: "Voxel world generation", vertical: "Gaming", size: "2.1 MB", files: 67, commits: 123 },

  // E-commerce
  { name: "imaginary-crime-lab", org: "bedwards", description: "Distributed e-commerce on Cloudflare", vertical: "E-commerce", size: "3.4 MB", files: 112, commits: 156 },
  { name: "liquidity", org: "bedwards", description: "Shopify Liquid theme utilities", vertical: "E-commerce", size: "780 KB", files: 28, commits: 45 },
  { name: "shopivibelize", org: "bedwards", description: "Playful Shopify workflows", vertical: "E-commerce", size: "560 KB", files: 19, commits: 34 },

  // Data Science
  { name: "wdi-py", org: "bedwards", description: "World Bank Development Indicators with Polars", vertical: "Data Science", size: "1.1 MB", files: 28, commits: 67 },
  { name: "graphyard", org: "bedwards", description: "Graph analysis tools", vertical: "Data Science", size: "2.3 MB", files: 78, commits: 145 },
  { name: "mania", org: "bedwards", description: "March Machine Learning Mania Kaggle", vertical: "Data Science", size: "4.5 MB", files: 89, commits: 178 },
  { name: "conduit", org: "bedwards", description: "Kaggle competition pipeline", vertical: "Data Science", size: "1.8 MB", files: 45, commits: 89 },
  { name: "gnn", org: "bedwards", description: "Graph Neural Networks", vertical: "Data Science", size: "3.2 MB", files: 67, commits: 134 },
  { name: "gyat", org: "bedwards", description: "Graph Predictive Attention Network", vertical: "Data Science", size: "2.1 MB", files: 56, commits: 112 },

  // Vibe Coding Meta
  { name: "nanochat", org: "bedwards", description: "The best ChatGPT that $100 can buy", vertical: "Vibe Coding", size: "2.3 MB", files: 45, commits: 127 },
  { name: "metavibe", org: "bedwards", description: "Meta-level vibe coding tools", vertical: "Vibe Coding", size: "1.2 MB", files: 34, commits: 78 },
  { name: "claude-base", org: "bedwards", description: "Foundation for Claude Code projects", vertical: "Vibe Coding", size: "890 KB", files: 23, commits: 56 },
  { name: "claude-exporter", org: "bedwards", description: "Parse Claude conversation exports", vertical: "Vibe Coding", size: "670 KB", files: 18, commits: 34 },
  { name: "vibe-coding", org: "bedwards", description: "Vibe coding resources and examples", vertical: "Vibe Coding", size: "1.5 MB", files: 42, commits: 89 },
];

const verticals = [...new Set(projects.map(p => p.vertical))];

const verticalColors: Record<string, string> = {
  "Education": "tag-accent",
  "Healthcare": "tag-green",
  "Music": "tag-yellow",
  "Gaming": "tag-red",
  "E-commerce": "tag-purple",
  "Data Science": "tag-green",
  "Vibe Coding": "tag-purple",
};
---

<BaseLayout title="Projects" pageContext={pageContext}>
  <!-- ============================================ -->
  <!-- PROJECT STATISTICS SECTION                   -->
  <!-- ============================================ -->
  <div class="py-16 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto border-b border-terminal-border">
    <!-- Header -->
    <div class="text-center mb-12">
      <div class="terminal-prompt text-lg mb-4">cat ./project-stats.json</div>
      <h1 class="text-4xl md:text-5xl font-bold mb-4">
        <span class="text-terminal-accent" id="total-counter">100</span><span class="text-terminal-green">+</span> Projects
      </h1>
      <p class="text-terminal-muted max-w-2xl mx-auto">
        Shipped fast. Built with vibe coding and Claude Code.
      </p>
    </div>

    <!-- Key Stats Grid with Animated Counters -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-12">
      <div class="stat-card card-hover">
        <div class="stat-value"><span class="counter" data-target="100">0</span>+</div>
        <div class="stat-label">GitHub Repos</div>
      </div>
      <div class="stat-card card-hover">
        <div class="stat-value"><span class="counter" data-target="6">0</span></div>
        <div class="stat-label">Major Verticals</div>
      </div>
      <div class="stat-card card-hover">
        <div class="stat-value"><span class="counter" data-target="15">0</span>+</div>
        <div class="stat-label">Roblox Games</div>
      </div>
      <div class="stat-card card-hover">
        <div class="stat-value"><span class="counter" data-target="5">0</span>+</div>
        <div class="stat-label">Kaggle Competitions</div>
      </div>
    </div>

    <!-- ASCII-Style Vertical Distribution Chart -->
    <div class="terminal-window mb-12">
      <div class="terminal-header">
        <span class="terminal-dot bg-terminal-red"></span>
        <span class="terminal-dot bg-terminal-yellow"></span>
        <span class="terminal-dot bg-terminal-green"></span>
        <span class="text-terminal-muted text-sm ml-2">projects-by-vertical.sh</span>
      </div>
      <div class="terminal-body">
        <div class="text-terminal-muted text-xs mb-4">$ ./analyze-verticals.sh --format=ascii</div>
        <div class="space-y-3 font-mono text-sm">
          <!-- Education -->
          <div class="flex items-center gap-3">
            <span class="w-24 text-terminal-accent truncate">Education</span>
            <div class="flex-1 h-6 bg-terminal-bg rounded overflow-hidden relative">
              <div class="progress-bar h-full bg-terminal-accent/60 rounded" data-width="85" style="width: 0%"></div>
            </div>
            <span class="w-12 text-right text-terminal-muted">18</span>
          </div>
          <!-- Healthcare -->
          <div class="flex items-center gap-3">
            <span class="w-24 text-terminal-green truncate">Healthcare</span>
            <div class="flex-1 h-6 bg-terminal-bg rounded overflow-hidden relative">
              <div class="progress-bar h-full bg-terminal-green/60 rounded" data-width="45" style="width: 0%"></div>
            </div>
            <span class="w-12 text-right text-terminal-muted">9</span>
          </div>
          <!-- Music -->
          <div class="flex items-center gap-3">
            <span class="w-24 text-terminal-yellow truncate">Music</span>
            <div class="flex-1 h-6 bg-terminal-bg rounded overflow-hidden relative">
              <div class="progress-bar h-full bg-terminal-yellow/60 rounded" data-width="70" style="width: 0%"></div>
            </div>
            <span class="w-12 text-right text-terminal-muted">14</span>
          </div>
          <!-- Gaming -->
          <div class="flex items-center gap-3">
            <span class="w-24 text-terminal-red truncate">Gaming</span>
            <div class="flex-1 h-6 bg-terminal-bg rounded overflow-hidden relative">
              <div class="progress-bar h-full bg-terminal-red/60 rounded" data-width="75" style="width: 0%"></div>
            </div>
            <span class="w-12 text-right text-terminal-muted">15</span>
          </div>
          <!-- E-commerce -->
          <div class="flex items-center gap-3">
            <span class="w-24 text-terminal-purple truncate">E-commerce</span>
            <div class="flex-1 h-6 bg-terminal-bg rounded overflow-hidden relative">
              <div class="progress-bar h-full bg-terminal-purple/60 rounded" data-width="50" style="width: 0%"></div>
            </div>
            <span class="w-12 text-right text-terminal-muted">10</span>
          </div>
          <!-- Data Science -->
          <div class="flex items-center gap-3">
            <span class="w-24 text-terminal-green truncate">Data Science</span>
            <div class="flex-1 h-6 bg-terminal-bg rounded overflow-hidden relative">
              <div class="progress-bar h-full bg-terminal-green/60 rounded" data-width="90" style="width: 0%"></div>
            </div>
            <span class="w-12 text-right text-terminal-muted">22</span>
          </div>
        </div>
        <div class="text-terminal-muted text-xs mt-4 pt-4 border-t border-terminal-border">
          <span class="text-terminal-green">Total:</span> 100+ projects across 6 verticals
        </div>
      </div>
    </div>

    <!-- Build Speed Showcase -->
    <div class="grid md:grid-cols-2 gap-6 mb-12">
      <div class="terminal-window card-hover">
        <div class="terminal-header">
          <span class="terminal-dot bg-terminal-red"></span>
          <span class="terminal-dot bg-terminal-yellow"></span>
          <span class="terminal-dot bg-terminal-green"></span>
          <span class="text-terminal-muted text-sm ml-2">build-speed.log</span>
        </div>
        <div class="terminal-body">
          <div class="text-terminal-muted text-xs mb-3">$ cat ./delivery-times.txt</div>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-terminal-green">Folk Care</span>
              <span class="text-terminal-accent font-bold">28 days</span>
            </div>
            <div class="flex justify-between">
              <span class="text-terminal-green">Ghost Note VST</span>
              <span class="text-terminal-accent font-bold">14 days</span>
            </div>
            <div class="flex justify-between">
              <span class="text-terminal-green">Imaginary Crime Lab</span>
              <span class="text-terminal-accent font-bold">21 days</span>
            </div>
            <div class="flex justify-between">
              <span class="text-terminal-green">Smash Showdown</span>
              <span class="text-terminal-accent font-bold">7 days</span>
            </div>
          </div>
          <div class="text-terminal-muted text-xs mt-4 pt-3 border-t border-terminal-border">
            <span class="text-terminal-yellow">Days, not months.</span> That's the vibe coding difference.
          </div>
        </div>
      </div>

      <div class="terminal-window card-hover">
        <div class="terminal-header">
          <span class="terminal-dot bg-terminal-red"></span>
          <span class="terminal-dot bg-terminal-yellow"></span>
          <span class="terminal-dot bg-terminal-green"></span>
          <span class="text-terminal-muted text-sm ml-2">open-source.stats</span>
        </div>
        <div class="terminal-body">
          <div class="text-terminal-muted text-xs mb-3">$ gh repo list --json name | wc -l</div>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-terminal-muted">Public Repositories</span>
              <span class="text-terminal-accent font-bold">50+</span>
            </div>
            <div class="flex justify-between">
              <span class="text-terminal-muted">Open Source Contributions</span>
              <span class="text-terminal-green font-bold">Active</span>
            </div>
            <div class="flex justify-between">
              <span class="text-terminal-muted">Kaggle Notebooks</span>
              <span class="text-terminal-purple font-bold">12+</span>
            </div>
            <div class="flex justify-between">
              <span class="text-terminal-muted">VST/CLAP Plugins</span>
              <span class="text-terminal-yellow font-bold">3</span>
            </div>
          </div>
          <div class="text-terminal-muted text-xs mt-4 pt-3 border-t border-terminal-border">
            <span class="text-terminal-green">Building in public</span> since 2023
          </div>
        </div>
      </div>
    </div>

    <!-- ASCII Timeline -->
    <div class="terminal-window">
      <div class="terminal-header">
        <span class="terminal-dot bg-terminal-red"></span>
        <span class="terminal-dot bg-terminal-yellow"></span>
        <span class="terminal-dot bg-terminal-green"></span>
        <span class="text-terminal-muted text-sm ml-2">vibe-coding-timeline.ascii</span>
      </div>
      <div class="terminal-body overflow-x-auto">
        <div class="text-terminal-muted text-xs mb-4">$ cat ./timeline.txt</div>
        <pre class="text-xs sm:text-sm font-mono leading-relaxed whitespace-pre">
<span class="text-terminal-accent">2023</span> ──────────────────────────────────────────────────────── <span class="text-terminal-accent">2025</span>
  │                                                              │
  ├─<span class="text-terminal-green">●</span> Claude Code Early Adopter                                  │
  │   └── First 10 projects shipped                             │
  │                                                              │
  ├───────<span class="text-terminal-yellow">●</span> Folk Care Healthcare Platform                       │
  │         └── 28 days, 312 commits                            │
  │                                                              │
  ├─────────────<span class="text-terminal-purple">●</span> Audio Forge RS (Rust Plugins)                │
  │               └── Ghost Note, nih-plug ecosystem            │
  │                                                              │
  ├──────────────────<span class="text-terminal-red">●</span> Splash Screen Studio                    │
  │                    └── 15+ Roblox games shipped             │
  │                                                              │
  └────────────────────────<span class="text-terminal-green">●</span> <span class="text-terminal-accent">100+ Projects Milestone</span>        ─┘
                             └── And counting...
        </pre>
      </div>
    </div>
  </div>

  <!-- ============================================ -->
  <!-- ORIGINAL PROJECTS SECTION                    -->
  <!-- ============================================ -->
  <div class="py-20 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
    <div class="text-center mb-12">
      <h2 class="text-4xl font-bold mb-4">Browse Projects</h2>
      <p class="text-terminal-muted max-w-2xl mx-auto">
        All built with vibe coding and Claude Code. Ranked by total file size.
        Click any project to view on GitHub.
      </p>
    </div>

    <!-- Filter by vertical -->
    <div class="flex flex-wrap justify-center gap-2 mb-12">
      <button class="tag tag-accent filter-btn active" data-vertical="all">All</button>
      {verticals.map(v => (
        <button class={`tag ${verticalColors[v]} filter-btn`} data-vertical={v}>{v}</button>
      ))}
    </div>

    <!-- Projects grid -->
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4" id="projects-grid">
      {projects.map(project => (
        <a
          href={`https://github.com/${project.org}/${project.name}`}
          target="_blank"
          rel="noopener noreferrer"
          class="terminal-window card-hover block project-card"
          data-vertical={project.vertical}
        >
          <div class="p-4 space-y-2">
            <div class="flex items-center justify-between">
              <h3 class="font-bold text-terminal-accent truncate">{project.name}</h3>
              <span class={`tag text-xs ${verticalColors[project.vertical]}`}>{project.vertical}</span>
            </div>
            <p class="text-terminal-muted text-sm truncate">{project.description}</p>
            <div class="flex items-center gap-4 text-xs text-terminal-muted">
              <span class="text-terminal-text">{project.org}</span>
              <span>{project.files} files</span>
              <span>{project.commits} commits</span>
              <span class="text-terminal-accent">{project.size}</span>
            </div>
          </div>
        </a>
      ))}
    </div>

    <div class="text-center mt-12 text-terminal-muted">
      <p>This is a subset of 100+ projects. See full list on <a href="https://github.com/bedwards" class="link-accent" target="_blank">GitHub</a>.</p>
    </div>
  </div>

  <ChatButton pageContext={pageContext} />

  <script>
    // ==========================================
    // Animated Counter Function
    // ==========================================
    function animateCounter(element: HTMLElement, target: number, duration: number = 2000) {
      let start = 0;
      const increment = target / (duration / 16);
      const timer = setInterval(() => {
        start += increment;
        if (start >= target) {
          element.textContent = target.toString();
          clearInterval(timer);
        } else {
          element.textContent = Math.floor(start).toString();
        }
      }, 16);
    }

    // ==========================================
    // Progress Bar Animation
    // ==========================================
    function animateProgressBars() {
      document.querySelectorAll('.progress-bar').forEach((bar) => {
        const targetWidth = bar.getAttribute('data-width');
        if (targetWidth) {
          setTimeout(() => {
            (bar as HTMLElement).style.transition = 'width 1.5s ease-out';
            (bar as HTMLElement).style.width = targetWidth + '%';
          }, 300);
        }
      });
    }

    // ==========================================
    // Intersection Observer for Animations
    // ==========================================
    const observerOptions = {
      threshold: 0.2,
      rootMargin: '0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          // Animate counters
          document.querySelectorAll('.counter').forEach((counter) => {
            const target = parseInt(counter.getAttribute('data-target') || '0');
            animateCounter(counter as HTMLElement, target);
          });

          // Animate progress bars
          animateProgressBars();

          // Stop observing after animation
          observer.disconnect();
        }
      });
    }, observerOptions);

    // Observe the stats section
    const statsSection = document.querySelector('.stat-card');
    if (statsSection) {
      observer.observe(statsSection);
    }

    // ==========================================
    // Project Filter Functionality (Original)
    // ==========================================
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        // Update active state
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active', 'ring-2', 'ring-terminal-accent'));
        btn.classList.add('active', 'ring-2', 'ring-terminal-accent');

        const vertical = btn.getAttribute('data-vertical');

        document.querySelectorAll('.project-card').forEach(card => {
          if (vertical === 'all' || card.getAttribute('data-vertical') === vertical) {
            (card as HTMLElement).style.display = 'block';
          } else {
            (card as HTMLElement).style.display = 'none';
          }
        });
      });
    });
  </script>
</BaseLayout>
